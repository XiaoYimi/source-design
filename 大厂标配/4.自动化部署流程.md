<h1 align="center">è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹</h1>

# è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹æ³¨æ„äº‹é¡¹
- [x] è´­ä¹°æœåŠ¡å™¨å®ä¾‹(æ–°äººä¼˜æƒ ï¼Œæ´»åŠ¨ä¼˜æƒ ã€å­¦ç”Ÿä¼˜æƒ ï¼ŒæŒ‰å¹´ä»˜è´¹)ã€‚
- [x] ç”±äºå‰åç«¯éƒ½é‡‡ç”¨`js`è¯­è¨€ï¼Œæ‰€ä»¥éœ€è¦`node`ç¯å¢ƒæ”¯æŒ;è€Œnodeç¯å¢ƒç‰ˆæœ¬å»ºè®®é€šè¿‡nvmæ¥ç®¡ç†ã€‚å¦å¤–ï¼Œ`ContOS7`åœ¨æ”¯æŒé«˜ç‰ˆæœ¬`node`ï¼Œéœ€è¦å®‰è£…ç›¸å…³è½¯ä»¶åŒ…(`gcc@8`ã€`make@4.3`ã€`glibc@2.28`)æ”¯æŒã€‚


## æœåŠ¡å™¨ç¯å¢ƒæ­å»ºå†…å®¹
- [x] `nvm`ç®¡ç†`node`ç‰ˆæœ¬å·¥å…·ã€‚
- [x] é…ç½®é«˜ç‰ˆæœ¬`node`ç¯å¢ƒæ”¯æŒ,å³å®‰è£…ç›¸å…³ä¾èµ–(`gcc@8`ã€`make@4.3`ã€`glibc@2.28`)æ”¯æŒã€‚
- [x] `git`ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚
- [x] `SSH`å…å¯†ç™»å½•æœåŠ¡å™¨é…ç½®ã€‚
- [x] `LNMP`ç½‘ç«™ç¯å¢ƒé…ç½®ã€‚
- [x] `MySQL`æ•°æ®åº“ç¯å¢ƒéƒ¨ç½²ã€‚

# æœåŠ¡å™¨ç¯å¢ƒéƒ¨ç½²

## `nvm`å·¥å…·å®‰è£…
- ç»ˆç«¯å‘½ä»¤æ“ä½œå¦‚ä¸‹ï¼š
```bash
## æ›´æ–°å·²å­˜åœ¨1è½¯ä»¶åŒ…ã€‚
sudo yum update -y

## å®‰è£…ç›¸å…³ä¾èµ–ã€‚
sudo yum install -y epel-release
sudo yum install -y curl

## ä»¥ bash æ–¹å¼ä¸‹è½½å¹¶å®‰è£… nvm å·¥å…·ã€‚
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

## æŸ¥çœ‹æ˜¯å¦å·²ç»å®‰è£…æˆåŠŸã€‚
nvm --version
```


## é«˜ç‰ˆæœ¬`node`ç¯å¢ƒæ”¯æŒ
- ç»ˆç«¯å‘½ä»¤æ“ä½œå¦‚ä¸‹ï¼š
```bash
## åœ¨æœ¬åœ°æ–‡ä»¶ ~/.bashc å†…å®¹æ·»åŠ é•œåƒæºé…ç½®ä¿¡æ¯ï¼Œ
echo "export NVM_NODEJS_ORG_MIRROR=https://npm.taobao.org/mirrors/node" >> ~/.bashrc


## å®‰è£…æœ€æ–°ç‰ˆ(--lts)ç‰ˆæœ¬ã€‚
nvm insltall --lts

## å¯ç”¨æœ€æ–°ç‰ˆæœ¬ node æ”¯æŒã€‚
nvm use --lts


## æŸ¥çœ‹ nodeã€npm ç‰ˆæœ¬ä¿¡æ¯ã€‚
npm -v

node -v

## æ­¤æ—¶æ‰§è¡ŒæŸ¥çœ‹ node ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæç¤ºæŠ¥é”™ï¼Œå³ç‰ˆæœ¬åº“è¿‡ä½ï¼Œå»ºè®®å‡çº§æ“ï¼›æŠ¥é…¬ä¿¡æ¯å¦‚ä¸‹ï¼š
### node: /lib64/libm.so.6: version `GLIBC_2.27' not found (required by node)
### node: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.20' not found (required by node)
### node: /lib64/libstdc++.so.6: version `CXXABI_1.3.9' not found (required by node)
### node: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.21' not found (required by node)
### node: /lib64/libc.so.6: version `GLIBC_2.28' not found (required by node)
### node: /lib64/libc.so.6: version `GLIBC_2.25' not found (required by node)

## æŸ¥çœ‹ glibc ç‰ˆæœ¬ä¿¡æ¯ï¼›è€Œå½“å‰ ContOS7 ä¸‹ç‰ˆæœ¬åº”è¯¥æ˜¯ 2.17ã€‚
ldd --version

## å‡çº§ glibc ç‰ˆæœ¬ä¿¡æ¯åˆ° 2.28ï¼›é€šè¿‡ wget ä¸‹è½½èµ„æºï¼Œå¹¶è§£å‹ã€æ„å»ºè¿è¡Œã€‚
wget http://ftp.gnu.org/gnu/libc/glibc-2.28.tar.gz
tar -zxvf glibc-2.28.tar.gz
cd glibc-2.28
mkdir build && cd build
../configure --prefix=/usr/local/glibc-2.28 --disable-profile --enable-add-ons --with-headers=/usr/local/glibc-2.28 --with-binutils=/usr/local/glibc-2.28/bin

## å‡çº§ gcc ç‰ˆæœ¬ä¿¡æ¯åˆ° 8ï¼›è¿½åŠ é…ç½®æ–‡ä»¶å¹¶å½¢æˆè½¯é“¾æ¥ã€‚
yum install -y centos-release-scl devtoolset-8-gcc*
mv /usr/bin/gcc /usr/bin/gcc-4.8.5
ln -s /opt/rh/devtoolset-8/root/bin/gcc /usr/bin/gcc
mv /usr/bin/g++ /usr/bin/g++-4.8.5
ln -s /opt/rh/devtoolset-8/root/bin/g++ /usr/bin/g++

## å‡çº§ make ç‰ˆæœ¬ä¿¡æ¯åˆ° 4.3ï¼›é€šè¿‡ wget ä¸‹è½½èµ„æºï¼Œå¹¶è§£å‹ã€æ„å»ºè¿è¡Œã€‚
wget http://ftp.gnu.org/gnu/make/make-4.3.tar.gz
tar -xzvf make-4.3.tar.gz && cd make-4.3/
./configure  --prefix=/usr/local/make
make && make install
cd /usr/bin/ && mv make make.bak
ln -sv /usr/local/make/bin/make /usr/bin/make


## åœ¨å‡çº§ glibcã€gccã€make ç‰ˆæœ¬ä¿¡æ¯åï¼Œå¯èƒ½ä¼šæç¤ºæŠ¥é”™ä¿¡æ¯ã€‚æˆ‘ä»¬å°†æ ¹æ®æç¤ºè¿›è¡Œæ“ä½œè§£å†³é—®é¢˜ã€‚

### é”™è¯¯æç¤ºï¼šThese critical programs are missing or too old: make bison compilerã€‚(ç”±äº make å·²å‡çº§ï¼Œå…¶å®ƒ bisonã€compiler éœ€è¦é‡æ–°å®‰è£…)
sudo yum install -y bison

### é”™è¯¯æç¤ºï¼šCannot find a valid baseurl for repo: centos-sclo-rh/x86_64ã€‚(ç”±äº CentOS7 çš„ SCL æºåœ¨ 2024å¹´6æœˆ30æ—¥ åœæ­¢ç»´æŠ¤ï¼Œscl æºé»˜è®¤ä½¿ç”¨ centos å®˜æ–¹çš„åœ°å€ï¼Œåº”å½“åˆ‡æ¢å›é˜¿é‡Œäº‘æºï¼‰
cd /etc/yum.repos.d/
mv CentOS-SCLo-scl.repo CentOS-SCLo-scl.repo.bak
mv CentOS-SCLo-scl-rh.repo CentOS-SCLo-scl-rh.repo.bak+

### æŸ¥çœ‹é…ç½® SLC é…ç½®
vim CentOS-SCLo-rh.repo
### æ–‡ä»¶ CentOS-SCLo-rh.repo å†…å®¹åº”å½“å¦‚ä¸‹ï¼š

#### [centos-sclo-rh]
#### name=CentOS-7 - SCLo rh
#### baseurl=https://mirrors.aliyun.com/centos/7/sclo/x86_64/rh/
#### gpgcheck=1
#### enabled=1
#### gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo


## ä½¿ç”¨ node -v å‘½ä»¤æ£€æµ‹æ˜¯å¦æ”¯æŒé«˜ç‰ˆæœ¬ nodeã€‚
node -v

### å¯èƒ½å­˜åœ¨ä»¥ä¸‹é”™è¯¯æç¤º
#### node: /lib64/libc.so.6: version `GLIBC_2.28' not found (required by node)
#### node: /lib64/libm.so.6: version `GLIBC_2.27' not found (required by node)
#### node: /lib64/libc.so.6: version `GLIBC_2.25' not found (required by node)
### é‡æ–°æ„å»º glibc@2.8ï¼Œå¹¶æ‰§è¡Œ make å®‰è£…
cd ~/glibc-2.28/build
../configure --prefix=/usr/local/glibc-2.28 --disable-profile --enable-add-ons --with-headers=/usr/local/glibc-2.28 --with-binutils=/usr/local/glibc-2.28/bin
make
make install

## å†æ¬¡ä½¿ç”¨ node -v å‘½ä»¤æ£€æµ‹æ˜¯å¦æ”¯æŒé«˜ç‰ˆæœ¬ nodeã€‚(è‹¥æ”¯æŒï¼Œåˆ™è¾“å‡º node ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦åˆ™è¯·è”ç³»é˜¿é‡Œäº‘å”®åæœåŠ¡)
node -v
```

## å‡çº§`git`å·¥å…·ç‰ˆæœ¬
- é˜¿é‡Œäº‘å¯ç”¨`git`ç‰ˆæœ¬ä¸º`1.8.3.1`, å¯èƒ½ä¸ç¬¦åˆé¡¹ç›®éœ€æ±‚(çœ‹å®é™…æƒ…å†µ,è‡ªè¡Œå†³å®š)ï¼Œå› æ­¤éœ€è¦å‡çº§`git`ç‰ˆæœ¬ã€‚
```bash
## ä¸‹è½½åœ°å€ï¼šwget https://mirrors.edge.kernel.org/pub/software/scm/git/git-<version>.tar.gz

## è¯·æ ¹æ®å®é™…éœ€è¦è¿›è¡Œå‡çº§!!!
```


## éƒ¨ç½²`SSH`å…å¯†ç™»å½•æœåŠ¡å™¨
### é˜¿é‡Œäº‘æœåŠ¡å™¨ç™»å½•æ–¹å¼
- [x] `SSHD`åè®®æ–¹å¼ï¼š
  - è´¦æˆ·å¯†ç æ¨¡å¼(`root`+å¯†ç )ã€‚
  - å¯†é’¥å¯¹æ¨¡å¼(ä¸Šä¼ å¯†é’¥å¯¹å…¬é’¥è‡³æœåŠ¡å™¨é…ç½®)ã€‚
- [x] `VNC`åè®®æ–¹å¼ï¼š
  - è´¦æˆ·å¯†ç æ¨¡å¼(`root`+å¯†ç )ã€‚
### é…ç½®å…å¯†ç™»å½•æœåŠ¡å™¨çš„åŸå› 
- [x] ç¦æ­¢å¤–éƒ¨è®¿é—®è¿æ¥ã€æ”»å‡»æ“ä½œæœåŠ¡å™¨ï¼Œä»…å…è®¸å¯†é’¥å¯¹ç”¨æˆ·è®¿é—®æœåŠ¡å™¨ã€‚
- [x] `Gitlab CI/CD` æµæ°´çº¿ï¼Œè‡ªåŠ¨éƒ¨ç½²ä»£ç è‡³æœåŠ¡å™¨ï¼Œéœ€è¦å…å¯†ç™»å½•æœåŠ¡å™¨ã€‚

### å…å¯†ç™»å½•æœåŠ¡å™¨æ“ä½œé…ç½®
1. åœ¨æœ¬åœ°ç”µè„‘è¿›å…¥`~/.ssh`ç›®å½•ï¼Œä½¿ç”¨``ssh-keygen``ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¯†é’¥å¯¹å‘½åæ ¼å¼ä¸º`ssh-<å…¬ç½‘IP>`ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨äº¤äº’æ“ä½œæç¤º`passphrase`è¿‡ç¨‹ï¼Œè¯·**ä¸è¦è¾“å…¥å¯†ç **ï¼Œç›´æ¥å›è½¦å³å¯ã€‚
```bash
## è¿›å…¥ ~/.ssh ç›®å½•
cd ~/.ssh
## ç”Ÿæˆå¯†é’¥å¯¹(ä¸éœ€è¦æ·»åŠ ä»»ä½•å‚æ•°é…ç½®)
ssh-keygen

### äº¤äº’æç¤ºï¼šEnter file in which to save the keyï¼Œå³è¾“å…¥å¯†é’¥å¯¹æ–‡ä»¶åç§°,è¾“å…¥å¯†é’¥å¯¹å‘½åæ ¼å¼ä¸º`ssh-<å…¬ç½‘IP>`å³å¯ã€‚
ssh-<å…¬ç½‘IP>

### äº¤äº’æç¤ºï¼šEnter passphraseï¼Œç”±äºé…ç½®å…å¯†ç™»å½•2æ“ä½œï¼Œå› æ­¤ä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦æ“ä½œå³å¯ï¼›åç»­å†æ¬¡è¾“å…¥æ£€éªŒï¼ŒåŒæ ·ç›´æ¥å›è½¦æ“ä½œå³å¯ã€‚
```

2. åœ¨æœ¬åœ°ç”µè„‘é€šè¿‡`scp`æŒ‡ä»¤å°†å¯†é’¥å¯¹å…¬é’¥æ–‡ä»¶`ssh-<å…¬ç½‘IP>.pub`ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨ç›®å½•`/root/.ssh`,å³ä»…å…è®¸`root`ç”¨æˆ·å…è´¹ç™»å½•è®¿é—®æœåŠ¡å™¨ã€‚
```bash
## ä¸Šä¼ å¯†é’¥å¯¹å…¬é’¥æ–‡ä»¶åˆ°ä¸Šä¼ è‡³æœåŠ¡å™¨ç›®å½•
cd ~/.ssh
scp ssh-<å…¬ç½‘IP>.pub root@<å…¬ç½‘IP>:/root/.ssh

### é¦–æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œåœ¨è¯†åˆ«æœåŠ¡å™¨<å…¬ç½‘IP>æ˜¯å¦å–å¾—ä¿¡ä»»æˆæƒï¼Œå°†äº¤äº’æç¤ºï¼šAre you sure you want to continue connectingï¼›è¾“å…¥`yes`å³å¯ã€‚
yes

### é¦–æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œéœ€è¦ä»¥å¯†ç è¿›è¡Œç™»å½•æœåŠ¡å™¨ï¼Œæ‰å¾—ä»¥é€šè¿‡ scp æŒ‡ä»¤ä¸Šä¼ æ–‡ä»¶ã€‚
è¾“å…¥ <å…¬ç½‘IP> ç™»å½•å¯†ç 

```

3. ç™»å½•é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥åˆ°ç›®å½•`/root/.ssh`ï¼Œå°†å…¬é’¥æ–‡ä»¶`ssh-<å…¬ç½‘IP>.pub`å†…å®¹è¿½åŠ åˆ°`authorized_keys`æ–‡ä»¶å†…å®¹ä¸­ã€‚
```bash
## è¿›å…¥ç›®å½• /root/.ssh
cd /root/.ssh

## æŸ¥çœ‹ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨å¯†é’¥å¯¹å…¬é’¥æ–‡ä»¶`ssh-<å…¬ç½‘IP>.pub`,å†æ‰§è¡Œåç»­æ“ä½œã€‚
ls -a

## è¿½åŠ å…¬é’¥æ–‡ä»¶å†…å®¹åˆ° authorized_keys æ–‡ä»¶ä¸­
cat ssh-<å…¬ç½‘IP>.pub >> authorized_keys

## æŸ¥çœ‹å…¬é’¥æ–‡ä»¶å†…å®¹,å¹¶ç¡®è®¤æ˜¯å¦è¿½åŠ æˆåŠŸã€‚
cat authorized_keys
```

4. ç™»å½•é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œç¼–è¾‘`SSHD`æœåŠ¡çš„é…ç½®æ–‡ä»¶`/etc/ssh/sshd_config`ï¼Œå¹¶ä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ã€‚
```bash

## å…è´¹ç™»å½•æœåŠ¡å™¨é…ç½®
PubkeyAuthentication yes  ## å¯†é’¥å¯¹ç™»å½•æ–¹å¼
AuthorizedKeysFile .ssh/authorized_keys


## è‹¥è®¾ç½®ä¸º noï¼Œåˆ™ç¦æ­¢å¯†ç ç™»å½•æ–¹å¼ï¼›ä½†é˜¿é‡Œäº‘ VNC å¯ä½¿ç”¨å¯†ç ç™»å½•æ–¹å¼ï¼Œå› ä¸º VNC ä¸åŸºäº SSHD åè®®ã€‚
PasswordAuthentication no ## å¯†ç ç™»å½•æ–¹å¼
```

5. é‡å¯`SSHD`æœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚
```bash
## é‡å¯ SSHD æœåŠ¡
systemctl restart sshd
```

6. æ­å–œä½ ï¼Œä½ å·²å®Œæˆå…å¯†ç™»å½•æœåŠ¡å™¨é…ç½®!!!


## éƒ¨ç½²`LNMP`ç½‘ç«™ç¯å¢ƒ

### ç†è§£`LNMP`ç½‘ç«™ç¯å¢ƒ
- `LNMP`ç¯å¢ƒæ˜¯ç”±`Linux`æ“ä½œç³»ç»Ÿã€`Nginx`æœåŠ¡å™¨ã€`MySQL`æ•°æ®åº“ã€`PHP`è„šæœ¬è¯­è¨€æ‰€æ„æˆçš„ç½‘ç«™æœåŠ¡å™¨ç¯å¢ƒã€‚ï¼ˆä½†å‰åç«¯é¡¹ç›®éƒ½é‡‡ç”¨`js`è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥è¯´æ˜¯`LNMJ`ç½‘ç«™ç¯å¢ƒäº†,ğŸ˜‚ğŸ˜‚ï¼‰
- `LNMP`ç½‘ç«™ç¯å¢ƒçš„å¸¸ç”¨ç›®å½•ï¼š
  - åœ¨`Nginx`æœåŠ¡å™¨ä¸­ï¼Œç½‘ç«™ç¯å¢ƒç›®å½•é»˜è®¤ä¸º`/usr/share/nginx/html`ï¼›åœ¨`Apache`æœåŠ¡å™¨ä¸­ï¼Œç½‘ç«™ç¯å¢ƒç›®å½•é»˜è®¤ä¸º`/var/www/html`ã€‚å¯é€šè¿‡é¡¹ç›®ç«™ç‚¹(`*.conf`)é…ç½®æŒ‡å®š`root`æ¥ä¿®æ”¹ç½‘ç«™ç¯å¢ƒç›®å½•ã€‚(ä¸ªäººå»ºè®®åœ¨ç½‘ç«™ç¯å¢ƒç›®å½•ä¸‹åˆ†åˆ«åˆ›å»º`dveelop`ä¸`product`ç›®å½•ï¼Œä»¥ä¾¿åŒºåˆ†å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒ)
  - `Nginx`æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸º`/etc/nginx/nginx.conf`ï¼›æ‰€æœ‰é¡¹ç›®ç«™ç‚¹(`*.conf`)é…ç½®éƒ½ç»Ÿä¸€åœ¨ç›®å½•`/etc/nginx/conf.d`ä¸‹åˆ›å»ºå¹¶é…ç½®å†…å®¹(`root`ã€`listen`ã€`server_name`ç­‰å…¶å®ƒé…ç½®)ã€‚
  - `MySQL`æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸º`/etc/my.cnf`ï¼›
- é¡¹ç›®ç«™ç‚¹é…ç½®æ“ä½œé¡ºåºï¼š
  1. åœ¨ç½‘ç«™ç¯å¢ƒç›®å½•ä¸‹åˆ›å»ºé¡¹ç›®ç«™ç‚¹ï¼ˆ`website`ï¼‰ï¼Œå°†å·²æ‰“åŒ…é¡¹ç›®çš„æ–‡ä»¶å†…å®¹ç§»åŠ¨é“é¡¹ç›®ç«™ç‚¹é‡Œï¼›
  2. åœ¨ç›®å½•`/etc/nginx/conf.d`ä¸‹åˆ›å»ºé¡¹ç›®ç«™ç‚¹é…ç½®æ–‡ä»¶(`website.conf`)ï¼Œå¹¶é…ç½®å†…å®¹(`root`ã€`listen`ã€`server_name`ç­‰å…¶å®ƒé…ç½®)ï¼›
  3. å‰å¾€äº‘æœåŠ¡å™¨é…ç½®å®‰å…¨ç»„æˆ–é˜²ç«å¢™è§„åˆ™ï¼Œå¼€æ”¾ç½‘ç«™ç«™ç‚¹ç«¯å£ï¼Œå…¶é…ç½®è§„åˆ™å¦‚ä¸‹ï¼š
  ```bash
  é˜¿é‡Œäº‘æ§åˆ¶å° -> äº‘æœåŠ¡å™¨ ECS -> ç‚¹å‡»æœåŠ¡å™¨å®ä¾‹ -> å®‰å…¨ç»„ -> ç®¡ç†è§„åˆ™ -> å…¥æ–¹å‘

  æ‰‹åŠ¨æ·»åŠ  -> åˆ†åˆ«è®¾ç½®æˆæƒç­–ç•¥ã€çª—å£èŒƒå›´ã€æˆæƒå¯¹è±¡ã€æè¿°ç­‰è¿›è¡Œè®¾ç½®ã€‚

  - çª—å£èŒƒå›´(8000/9000): è¡¨ç¤º 8080 - 9000 ç«¯å£é›†åˆã€‚
  - çª—å£èŒƒå›´(8080/8080): è¡¨ç¤º 8080 ç«¯å£ã€‚
  - æˆæƒå¯¹è±¡(0.0.0.0/0)ï¼šè¡¨ç¤ºä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ã€‚
  - æˆæƒç­–ç•¥(æ‹’ç»æˆ–å…è®¸) + æˆæƒå¯¹è±¡: å®ç°ç½‘ç«™è®¿é—®é»‘åå•è´§ç™½åå•ã€‚

  - å¼€æ”¾ç«¯å£è®¿é—®ï¼šæˆæƒç­–ç•¥ã€çª—å£èŒƒå›´ã€æˆæƒå¯¹è±¡(è‡ªå®šä¹‰)ã€æè¿°(ç½‘ç«™ç«™ç‚¹)ï¼›
  - å°ç¦IPè®¿é—®ï¼šæˆæƒç­–ç•¥(æ‹’ç») + æˆæƒå¯¹è±¡(IPæˆ–ç½‘æ®µ)ï¼›
  ```


### æ­å»º`LNMP`ç½‘ç«™ç¯å¢ƒ
1. å…³é—­é˜²ç«å¢™`firewalld`ï¼Œæ£€æµ‹`getenforce`çŠ¶æ€ä¸º`disabled`æ—¶ï¼Œå®‰è£…`nginx`ä¾èµ–ã€‚
```bash
## å…³é—­é˜²ç«å¢™
sudo systemctl stop firewalld
# systemctl disable firewalld

## æ£€æµ‹ getenforce çŠ¶æ€ä¸º disabled æ—¶ï¼Œå®‰è£… nginx ä¾èµ–
sudo getenforce  ## disabled æ—¶ï¼Œå†æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚

## å®‰è£… nginx ä¾èµ–
sudo yum -y install nginx
```

2. é¡¹ç›®ç«™ç‚¹é…ç½®ï¼Œä»¥`website`é¡¹ç›®ç«™ç‚¹ä¸ºä¾‹ã€‚
```bash
## è¿›å…¥ç½‘ç«™ç¯å¢ƒç›®å½•
cd /usr/share/nginx/html

## åˆ›å»ºé¡¹ç›®ç«™ç‚¹ç›®å½•
sudo mkdir website

## è¿›å…¥é¡¹ç›®ç«™ç‚¹ç›®å½•
cd website

## å°†å·²æ‰“åŒ…é¡¹ç›®çš„æ–‡ä»¶å†…å®¹ç§»åŠ¨åˆ°é¡¹ç›®ç«™ç‚¹ç›®å½•(åç»­å°†è¯¥ç§»åŠ¨æ“ä½œäº¤ç”±äº Gitlab CI/CD æµæ°´çº¿è‡ªåŠ¨åŒ–éƒ¨ç½²)ï¼Œä»¥ä¸‹æ–¹å¼é€‚åˆä¸åŒåœºæ™¯è¿›è¡Œä¸Šä¼ å·²æ‰“åŒ…å¥½çš„é¡¹ç›®æ–‡ä»¶ã€‚

### æ–¹å¼1: æœ¬åœ°ç”µè„‘å·²æ‰“åŒ…å¥½çš„é¡¹ç›®æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨é¡¹ç›®ç«™ç‚¹ç›®å½•ï¼Œå¯é€šè¿‡æŒ‡ä»¤ftpã€scpç­‰æ“ä½œè¿›è¡Œä¸Šä¼ ã€‚ï¼ˆç”±äºæœåŠ¡å™¨å·²é…ç½®å…å¯†ç™»å½•æœåŠ¡å™¨ï¼Œå› æ­¤æœ¬ä¾‹é‡‡ç”¨ scp + ç§é’¥éªŒè¯æ–¹å¼ä¸Šä¼ ; ç‰¹åˆ«æ³¨æ„ï¼š è¯·åœ¨æœ¬åœ°ç”µè„‘ä¸Šæ“ä½œç»ˆç«¯å‘½ä»¤ï¼‰
scp -i ssh-<å…¬ç½‘IP>çš„ç§é’¥æ–‡ä»¶åœ°å€ -P sshç«¯å£å€¼ å·²æ‰“åŒ…çš„é¡¹ç›®æ–‡ä»¶åœ°å€ root@<å…¬ç½‘IP>:/usr/share/nginx/html/website

### æ–¹å¼2: æœåŠ¡å™¨å†…å­˜åœ¨å·²æ‰“åŒ…é¡¹ç›®æ–‡ä»¶åœ°å€(/root/project/website)ï¼Œç§»åŠ¨åˆ°é¡¹ç›®ç«™ç‚¹ç›®å½•ã€‚ï¼ˆç§»å…¥å‰ï¼š/root/project/website/*ã€‚ç§»å…¥åï¼š/usr/share/nginx/html/website/*ã€‚ï¼‰
sudo mv /root/project/website/* /usr/share/nginx/html/website

### æ–¹å¼3: é€šè¿‡ GitLab CI/CD æµæ°´çº¿è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå°†å·²æ‰“åŒ…é¡¹ç›®æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®ç«™ç‚¹ç›®å½•,è¯¦è§æœ¬åœ°ç”µè„‘é¡¹ç›® gitlab-ci.yml é…ç½®é˜¶æ®µé‡Œæ‰€æ‰§è¡Œçš„ï¼ˆæœåŠ¡å™¨ï¼‰è„šæœ¬å‘½ä»¤ã€‚é˜¶æ®µï¼ˆå¼€å‘ï½œä¸Šçº¿ï¼‰é‡Œçš„é…ç½®å¦‚ä¸‹ï¼š
#### job_[deploy | release]
####   stage: deploy | release
####   only:
####   - [å¼€å‘-branchesï¼Œä¸Šçº¿-master]
####   environment:
####     name: 'é¡¹ç›®åç§°'
####     url: 'é¡¹ç›®è®¿é—®åœ°å€'
####   artifacts:
####     paths:
####       - 'é¡¹ç›®æ‰“åŒ…æ–‡ä»¶åœ°å€'(é¿å…ä¸‹æ¬¡è¦†ç›–åæ— æ³•æ‰¾åˆ°æŸä¸€ç‰ˆæœ¬çš„é¡¹ç›®æ–‡ä»¶)
####   script:
####     - echo 'é˜¶æ®µã€deploy | releaseã€‘ï¼šå¼€å§‹éƒ¨ç½²'
####     - npm run build
####     - mv ./dist ./ç½‘ç«™ç«™ç‚¹-[deploy | release]@x.x.x
####     - scp -i ssh-<å…¬ç½‘IP>çš„ç§é’¥æ–‡ä»¶åœ°å€ -P sshç«¯å£å€¼ ./ç½‘ç«™ç«™ç‚¹-[deploy | release]@x.x.x root@<å…¬ç½‘IP>:/usr/share/nginx/html/website
####     - echo 'é¡¹ç›®éƒ¨ç½²æˆåŠŸï¼'


```

3. é…ç½®é¡¹ç›®ç«™ç‚¹é…ç½®æ–‡ä»¶(`website.conf`)å†…å®¹ï¼š
```conf
## é¡¹ç›®ç«™ç‚¹é…ç½®
server {
    ## http ç«¯å£(å¿…å¡«)
    listen 8080;

    ## https ç«¯å£(å¿…å¡«)
    listen 443 ssl;

    ## https è¯ä¹¦ ##
    ### https è¯ä¹¦æ–‡ä»¶åœ°å€
    ssl_certificate /etc/nginx/ssl/website.crt;
    ### https è¯ä¹¦ç§é’¥åœ°å€
    ssl_certificate_key /etc/nginx/ssl/website.key;


    ## åŸŸåæˆ–IP(å¿…å¡«)
    server_name <å…¬ç½‘IP>;

    # å®šä¹‰æœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—
    access_log  /var/log/nginx/weisite.access.log;
    # å®šä¹‰æœåŠ¡å™¨çš„é”™è¯¯æ—¥å¿—
    error_log  /var/log/nginx/weisite.error.log;

    # å®šä¹‰ç½‘ç«™æ ¹ç›®å½•
    location / {
        root   /usr/share/nginx/html/website;
        index  index.html index.htm;

        ## æœ€åä¸€ä¸ªä»£ç†IPæˆ–çœŸå®IP
        proxy_set_header X-Real-IP $remote_addr;
        ## ä»£ç†IPé›†
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # å®šä¹‰é”™è¯¯é¡µé¢
    error_page  404  /404.html;
    location = /40x.html {
        ## å¤ç”¨é¡¶å±‚çš„ 404.htmlï¼Œä¹Ÿå¯æŒ‡å®šé¡¹ç›®ç«™ç‚¹ 404 é¡µé¢
        root   /usr/share/nginx/html;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        ## å¤ç”¨é¡¶å±‚çš„ 50x.htmlï¼Œä¹Ÿå¯æŒ‡å®šé¡¹ç›®ç«™ç‚¹ 5xx é¡µé¢
        root   /usr/share/nginx/html;
    }
}
```

## éƒ¨ç½²`MySQL`æ•°æ®åº“ç¯å¢ƒ
- æœ¬æ¡ˆä¾‹ä»¥`MySQL@8.0.x`ä¸ºä¾‹ï¼Œå…¶å®ƒç‰ˆæœ¬è¯·è‡ªè¡Œç™¾åº¦ã€‚
- ç»ˆç«¯å‘½ä»¤æ“ä½œå¦‚ä¸‹ï¼š
```bash
## æ›´æ–° MySQL å®˜æ–¹ Yum æº
sudo rpm -Uvh https://dev.mysql.com/get/mysql80-community-release-el7-11.noarch.rpm

## å®‰è£… MySQL
sudo yum -y install mysql-community-server

## æŸ¥çœ‹ mysql ç‰ˆæœ¬
mysql -V

## å¯åŠ¨ MySQL æœåŠ¡
sudo systemctl start mysqld

## è®¾ç½® MySQL å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable mysqld
sudo systemctl daemon-reload

## æŸ¥çœ‹/var/log/mysqld.logæ–‡ä»¶ï¼Œè·å– root ç”¨æˆ·çš„åˆå§‹å¯†ç ã€‚
sudo grep 'temporary password' /var/log/mysqld.log
### æŸ¥çœ‹å¯†ç æ–‡ä»¶ä¼šä¿¡æ¯æç¤ºï¼Œå­—æ®µ ARQTRy3+**** ä¸ºåˆå§‹å¯†ç ã€‚å¦‚ä¸‹ï¼š
#### 2021-11-10T07:01:26.595215Z 1 [Note] A temporary password is generated for root@localhost: ARQTRy3+****

## é…ç½® MySQL çš„å®‰å…¨æ€§ï¼Œå¹¶é‡ç½®åˆå§‹åŒ–å¯†ç ã€‚
sudo mysql_secure_installation

### äº¤äº’æç¤ºï¼šè¾“å…¥ root ç”¨æˆ·çš„åˆå§‹åŒ–å¯†ç (Enter password for user root):
æ‰‹åŠ¨è¾“å…¥ ARQTRy3+****

### äº¤äº’æç¤ºï¼šè®¾ç½®ä¸€ä¸ªæ–°å¯†ç (Please set a new password. New Password):
è‡ªå®šä¹‰è®¾ç½® mysql ç™»å½•å¯†ç ï¼Œå¦‚ 123456

### äº¤äº’æç¤ºï¼šå†æ¬¡ç¡®è®¤æ–°å¯†ç (Re-enter new password):
å†æ¬¡è¾“å…¥è‡ªå®šä¹‰ mysql ç™»å½•å¯†ç ï¼Œå¦‚ 123456

### äº¤äº’æç¤ºï¼šæ˜¯å¦å¯ç”¨æ–°å¯†ç ï¼Œå¦åˆ™é‡æ–°è®¾ç½®æ–°å¯†ç .Y è¡¨ç¤ºæ˜¯ï¼Œå…¶å®ƒé”®ä¸ºå†æ¬¡é‡æ–°è®¾ç½®ã€‚(Do you wish to continue with the password provided?)
Y

### äº¤äº’æç¤ºï¼šåˆ é™¤éšåŒ¿ç”¨æˆ·(Remove anonymous users)
Y

### äº¤äº’æç¤ºï¼šç¦æ­¢ä½¿ç”¨ root ç”¨æˆ·ç™»å½• mysql æœåŠ¡(Disallow root login remotely)
Y

### äº¤äº’æç¤ºï¼šåˆ é™¤ test åº“ä»¥åŠå¯¹ test åº“çš„è®¿é—®æƒé™(Remove test database and access to it):
Y

### äº¤äº’æç¤ºï¼šé‡æ–°åŠ è½½æ•°æ®åº“æˆæƒè¡¨(Reload privilege tables now)
Y

## ç™»å½• MySQL
mysql -uroot -p<MySQLç™»å½•å¯†ç >
```
- æ­å–œä½ ï¼ŒMySQL æ•°æ®åº“ç¯å¢ƒå·²éƒ¨ç½²æˆåŠŸï¼


# æœåŠ¡å™¨åº”ç”¨éƒ¨ç½²

## GitLab åº”ç”¨éƒ¨ç½²
### å¿«é€Ÿç†è§£ GitLab
- ä»£ç å­˜å‚¨åº“ã€‚

### éƒ¨ç½²æµç¨‹
1. å®‰è£…ç›¸å…³è½¯ä»¶åŒ…,åˆå§‹åŒ–é…ç½®ã€å¯åŠ¨æœåŠ¡ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
```bash
## å®‰è£… GitLab ç›¸å…³è½¯ä»¶åŒ…
sudo yum install -y curl python3-policycoreutils openssh-server

## å¯åŠ¨ SSHD æœåŠ¡
sudo systemctl enable sshd
sudo systemctl start sshd

## å®‰è£…å¹¶é…ç½® Postfix æœåŠ¡
sudo yum install -y postfix
sudo systemctl enable postfix
sudo systemctl start postfix

```

2. å®‰è£…é…ç½®`GitLab`è½¯ä»¶åŒ…ï¼Œå¹¶å¯åŠ¨æœåŠ¡ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
```bash
## ä¸‹è½½ GitLab è½¯ä»¶åŒ…
curl -fsSL https://get.gitlab.cn | sudo /bin/bash

## å®‰è£… GitLab è½¯ä»¶åŒ…ï¼Œå¹¶é…ç½®æœåŠ¡è®¿é—®å…¥å£åœ°å€(å…¬ç½‘IP ä¸åŒ…å« http:// æˆ–ç«¯å·å£)
sudo EXTERNAL_URL=å…¬ç½‘IP> yum install -y gitlab-jh

## å®‰è£…æˆåŠŸä¹‹åï¼Œé€šè¿‡è®¿é—®å…¥å£åœ°å€è¿›å…¥ç™»å½•é¡µé¢ã€‚é»˜è®¤ç”¨æˆ·åä¸ºæ¶ rootï¼Œå¯é€šè¿‡æœåŠ¡å™¨ç»ˆç«¯å‘½ä»¤è·å–ç™»å½•å¯†ç ã€‚
### ç‰¹åˆ«æ³¨æ„ï¼šç™»å½•å¯†é’¥æœ‰æ•ˆæœŸæ—¶é—´ä¸º 24 å°æ—¶ï¼›è¯·åŠæ—¶ç™»å½•å¹¶ä¿®æ”¹åŸå§‹å¯†ç ï¼›ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
sudo cat /etc/gitlab/initial_root_password
```

3. ä¿®æ”¹é…ç½®æ–‡ä»¶`/etc/gitlab/gitlab.rb`å†…å®¹ï¼š `GitLab`ä¸»é¡µè®¿é—®ç«¯å£å€¼ã€‚
- [x] é…ç½®`GitLab`ä¸»é¡µè®¿é—®ç«¯å£,ç»ˆç«¯æ“ä½œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
## ä½¿ç”¨ vim å‘½ä»¤ä¿®æ”¹ GitLab æ–‡ä»¶é…ç½®ã€‚
vim /etc/gitlab/gitlab.rb

## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",æ£€ç´¢å…³é”®å­— nginx['listen_port']ï¼Œå¹¶ä¿®æ”¹ä¸º 8080 ç«¯å£ã€‚
nginx['listen_port'] = 8080


## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",è¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºï¼›å¹¶é‡å¯ GitLab æœåŠ¡é…ç½®ã€‚
sudo gitlab-ctl reconfigure

## ç­‰å¾… 10såï¼Œä»¥ "<å…¬ç½‘IP>:<ç«¯å£å·>" é‡æ–°è®¿é—® GitLab ä¸»é¡µï¼Œå¹¶è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚
```

- [x] é…ç½®`GitLab`ä»£ç ä»“åº“å…å¯†æ“ä½œ(ä»£ç ä¸‹è½½ã€æ¨é€ã€æ‹‰å–ç­‰æ“ä½œ)ï¼Œç»ˆç«¯æ“ä½œå‘½ä»¤å¦‚ä¸‹ï¼š
  - åœ¨æœ¬åœ°ç”µè„‘ç›®å½•`./.ssh`ä¸‹ä½¿ç”¨ç»ˆç«¯å‘½ä»¤`keygen`ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå‘½åæ ¼å¼ä¸ºï¼š`<å¼€å‘è€…æ˜µç§°>-ssh-<gitlabåº”ç”¨å>`ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
  ```bash
    ## è¿›å…¥æœ¬åœ°ç”µè„‘ç›®å½• ./.ssh ä¸‹
    cd ~/.ssh

    ## ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶å‘½åæ ¼å¼ä¸ºï¼š<å¼€å‘è€…>-ssh-<gitlabåº”ç”¨å>
    ssh-keygen -t rsa -b 4096 -C "<å¼€å‘è€…>-ssh-<å…¬ç½‘IP>-<GitLabæœåŠ¡ç«¯å£>"

    ## ç”±äºéœ€è¦å…å¯†ç™»å½•æ“ä½œè¦æ±‚ï¼Œå› æ­¤åœ¨äº¤äº’æç¤ºä¸­ä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦æ“ä½œå³å¯ã€‚
    ## å†æ¬¡ç¡®è®¤å¯†ç é˜¶æ®µï¼ŒåŒæ ·å›è½¦æ“ä½œã€‚
  ```

  - åœ¨åœ¨æµè§ˆå™¨ä¸­ç™»å½•`GitLab`åº”ç”¨ï¼Œå¹¶è¿›å…¥ä¸»é¡µã€‚é€šè¿‡ç‚¹å‡»`ç”¨æˆ·å¤´åƒ`->`Preferences`ï¼Œé€‰æ‹©`SSH Keys`ï¼Œç‚¹å‡»`Add new key`å³å¯ã€‚ï¼ˆ`key`ä¸ºå…¬é’¥æ–‡ä»¶å†…å®¹ï¼Œ`title`é»˜è®¤ä¼šè‡ªåŠ¨å¡«å……å†…å®¹ï¼Œå¦åˆ™ä¸ä»¥å¯†é’¥å¯¹å‘½åæ ¼å¼ä¸ºå€¼ï¼‰

  - ä¿®æ”¹é…ç½®æ–‡ä»¶`/etc/gitlab/gitlab.rb`å†…å®¹ï¼š `GitLab`ä¸­`SSHD`æœåŠ¡è®¿é—®ç«¯å£å€¼ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
  ```bash
    ## ä½¿ç”¨ vim å‘½ä»¤ä¿®æ”¹ GitLab æ–‡ä»¶é…ç½®ã€‚
    vim /etc/gitlab/gitlab.rb

    ## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",æ£€ç´¢å…³é”®å­— gitlab_rails['gitlab_ssh_host']ï¼Œå¹¶ä¿®æ”¹ä¸º <å…¬ç½‘IP>ã€‚
    gitlab_rails['gitlab_ssh_host'] = <å…¬ç½‘IP>ï¼›

    ## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",æ£€ç´¢å…³é”®å­— gitlab_rails['gitlab_shell_ssh_port']ï¼Œå¹¶ä¿®æ”¹ä¸º <GitLab SSH æœåŠ¡ç«¯å£>ã€‚
    gitlab_rails['gitlab_shell_ssh_port']  <GitLab SSH æœåŠ¡ç«¯å£>ï¼›

    ## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",è¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºï¼›å¹¶é‡å¯ GitLab æœåŠ¡é…ç½®ã€‚
    sudo gitlab-ctl reconfigure

    ## ç­‰å¾… 10såï¼Œä»¥ "<å…¬ç½‘IP>:<ç«¯å£å·>" é‡æ–°è®¿é—® GitLab ä¸»é¡µï¼Œå¹¶è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼›è®¿é—®ä»»æ„ä»£ç ä»“åº“ï¼Œç‚¹å‡»"clone"ï¼Œé€‰æ‹©"SSH"ï¼Œå°±å¯ç¡®è®¤æ˜¯å¦é…ç½®æˆåŠŸã€‚

    ## è®¿é—® GitLab SSHD ç«¯å£çš„è¿é€šæ€§ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼šï¼ˆè‹¥ telnet å­˜åœ¨ï¼Œåˆ™éœ€å®‰è£…è¯¥è½¯ä»¶åŒ…ï¼š sudo yum install -y telnetï¼‰
    æ–¹å¼1: æœåŠ¡å™¨ç»ˆç«¯å‘½ä»¤æµ‹è¯•ï¼štelnet <å…¬ç½‘IP> <GitLab SSH æœåŠ¡ç«¯å£>
    æ–¹å¼2: æœ¬åœ°ç”µè„‘ç»ˆç«¯å‘½ä»¤æµ‹è¯•ï¼šssh -T -p <GitLab SSH æœåŠ¡ç«¯å£> git@<å…¬ç½‘IP>

    ## è‹¥åœ¨æµ‹è¯• GitLab SSHD ç«¯å£çš„è¿é€šæ€§è¿‡ç¨‹æŠ¥é”™ï¼Œè¯·æ ¹æ®ä»¥ä¸‹æŒ‡å¼•è‡ªè¡Œæ£€æµ‹ï¼Œæˆ–å’¨è¯¢é˜¿é‡Œäº‘å”®åæœåŠ¡ã€‚
    ### 1. æ£€æŸ¥æœåŠ¡å™¨å®‰å…¨ç»„å…¥ç«™è§„åˆ™ï¼Œä»…ä¿è¯å¯¹å¤–å¼€æ”¾è®¿é—®çš„æƒé™ã€‚
    ### 2. æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™çŠ¶æ€ï¼›è‹¥å·²å¯åŠ¨ï¼Œè¯·æ£€æµ‹è¯¥ SSHD ç«¯å£æ˜¯å¦åœ¨é˜²ç«å¢™ç™¾åå•åˆ—è¡¨ä¸Šã€‚
    ### 3. æ£€æŸ¥æœåŠ¡å™¨ SSHD æœåŠ¡çŠ¶æ€ï¼›è‹¥å·²å¯åŠ¨ï¼Œè¯·æ£€æµ‹è¯¥ SSHD ç«¯å£æ˜¯å¦åœ¨åœ¨ SSHD æœåŠ¡é…ç½®æ–‡ä»¶ä¸­ã€‚
    ### å°æŠ€å·§çŸ¥è¯†
    #### æŸ¥çœ‹ SSHD æœåŠ¡å¼€æ”¾åˆ—è¡¨ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼šss -tnlp | grep sshd æˆ– netstat -tnlp | grep sshdã€‚

    #### å¯èƒ½éœ€è¦å¯¹æœ¬åœ°ç”µè„‘ ssh è¿›è¡Œé…ç½® config å†…å®¹ï¼Œé…ç½®æ–‡ä»¶ä½ç½®ä¸º ./.ssh/configï¼Œé…ç½®å†…å®¹æ ¼å¼å¦‚ä¸‹ï¼š
    ##### Host git@<ä»£ç ä»“åº“å¹³å°IPæˆ–åŸŸå> ## å›ºå®šæ ¼å¼ï¼š git@<åŸŸåæˆ–IP>
    ##### Port <ä»£ç ä»“åº“å¹³å°SSHæœåŠ¡ç«¯å£> ## å›ºå®šæ ¼å¼ï¼š <GitLab SSHD ç«¯å£å€¼>
    ##### HostName <ä»£ç ä»“åº“å¹³å°åç§°>  ## ç›¸å½“äºå”¯ä¸€æ ‡è¯†ï¼Œä¸€èˆ¬ä¸ºä»£ç ä»“åº“å¹³å°åç§°ï¼Œå¦‚ï¼šgithubã€‚
    ##### User git  ## å›ºå®šæ ¼å¼ï¼š git
    ##### IdentityFile ~/.ssh/<å¼€å‘è€…æ˜µç§°>-ssh-<ä»£ç ä»“åº“å¹³å°åç§°>.pem ## SSH å¯†é’¥æ–‡ä»¶è·¯å¾„

  ```

- [x] é…ç½®`GitLab`ä¸»é¡µé¡µé¢ä¸ºä¸­æ–‡ä¸»é¢˜ï¼Œæ“ä½œå¦‚ä¸‹ï¼š
  - ç™»å½•`GitLab`é¡µé¢ï¼Œå¹¶ç‚¹å‡»`Admin`ï¼Œé€‰æ‹©èœå•å¯¼èˆª`Preferences`å±•å¼€é¢æ¿ã€‚
  - åœ¨é¢æ¿ä¸­æ‰¾åˆ°`Localization`ä½ç½®ï¼Œé€šè¿‡`Default language`ä¸‹æ‹‰é€‰é¡¹è®¾ç½®æŒ‡å®šå›½é™…åŒ–ä¸»é¢˜è¯­è¨€ã€‚

- [x] å›æ˜¾`GitLab`é¡µé¢å¤´åƒï¼Œæ“ä½œå¦‚ä¸‹ï¼š
  - ç™»å½•`GitLab`é¡µé¢ï¼Œå¹¶ç‚¹å‡»`Admin`ï¼Œé€‰æ‹©èœå•å¯¼èˆª`General`è·³è½¬æ–°é¡µé¢ï¼›
  - åœ¨é¡µé¢ä¸­æ‰¾åˆ°`Account and limit`ä½ç½®ï¼Œç‚¹å‡»`Expand`ï¼Œå»é™¤å‹¾é€‰`Gravatar enabled`ï¼Œå¹¶ä¿å­˜ä¿®æ”¹ã€‚

- [x] é…ç½®é‡‘åº¸`GitLab`æ³¨å†Œé¡µé¢å…¥å£ï¼Œä»¥é˜²éç»„ç»‡æˆå‘˜æ³¨å†Œã€‚æ“ä½œå¦‚ä¸‹ï¼š
  - ç™»å½•`GitLab`é¡µé¢ï¼Œå¹¶ç‚¹å‡»`Admin`ï¼Œé€‰æ‹©èœå•å¯¼èˆª`General`è·³è½¬æ–°é¡µé¢ï¼›
  - åœ¨é¡µé¢ä¸­æ‰¾åˆ°`Sign-up restrictions`ä½ç½®ï¼Œç‚¹å‡»`Expand`ï¼Œå»é™¤å‹¾é€‰`Sign-up enabled`ï¼Œå¹¶ä¿å­˜ä¿®æ”¹ã€‚

- [x] é…ç½®`GitLab`é‚®ä»¶æœåŠ¡(`SMTP`)ã€‚
  - é…ç½®é‚®ä»¶æœåŠ¡(`SMTP`),ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
  ```bash
    ## ä½¿ç”¨ vim å‘½ä»¤ä¿®æ”¹ GitLab æ–‡ä»¶é…ç½®ã€‚
    vim /etc/gitlab/gitlab.rb

    ## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",æ£€ç´¢å…³é”®å­— ä»¥ä¸‹ç­‰å·å·¦ä¾§å€¼ï¼Œå¹¶æŒ‰å®é™…è¦æ±‚ä¿®æ”¹ä¸ºå®é™…å€¼ã€‚
    ### ç‰¹åˆ«æ³¨æ„ï¼š(æœ¬ä¾‹ä»¥ QQ é‚®ç®±åœºæ™¯è¿›è¡Œ SMTP é…ç½®)
    #### smtp_port = 465ï¼Œæ˜¯ QQ é‚®ç®±ç«¯å£å€¼ï¼Œä¸å¯æ”¹å˜ï¼›å…¶å®ƒé‚®ç®±æ‰€å¯¹åº”ç«¯å£ï¼Œè¯¦è§ GitLab SMTP é…ç½®æ–‡æ¡£ã€‚
    #### smtp_user_name ä¸ gitlab_email_from çš„é‚®ç®±è´¦æˆ·å€¼å¿…é¡»ä¸€è‡´ã€‚
    #### smtp_password ä¸ºé‚®ç®±è´¦æˆ·çš„æˆæƒç ã€‚
    gitlab_rails['smtp_enable'] = true
    gitlab_rails['smtp_domain'] = "qq.com"
    gitlab_rails['smtp_address'] = "smtp.qq.com"
    gitlab_rails['smtp_port'] = 465
    gitlab_rails['smtp_user_name'] = "QQ é‚®ç®±è´¦æˆ·"
    gitlab_rails['gitlab_email_from'] = "QQ é‚®ç®±è´¦æˆ·"
    gitlab_rails['smtp_password'] = "password"
    gitlab_rails['smtp_tls'] = true
    gitlab_rails['smtp_authentication'] = "login"
    gitlab_rails['smtp_enable_starttls_auto'] = false

    ## åœ¨ vim ç•Œé¢ä½¿ç”¨"å‘½ä»¤æ¨¡å¼",è¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºï¼›å¹¶é‡å¯ GitLab æœåŠ¡é…ç½®ã€‚
    sudo gitlab-ctl reconfigure

    ## æµ‹è¯• GitLab é‚®ä»¶æœåŠ¡æ˜¯å¦é…ç½®æˆåŠŸã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
    ### è°ƒç”¨ GitLab æ§åˆ¶å°
    gitlab-rails console

    ### æŸ¥çœ‹ GitLab é‚®ä»¶æœåŠ¡é…ç½®å†…å®¹ï¼Œè¯·è‡ªè¡Œæ£€æŸ¥ã€‚
    ActionMailer::Base.smtp_settings

    ## ä½¿ç”¨ GitLab é‚®ä»¶æœåŠ¡å‘ QQ é‚®ç®±ç”¨æˆ·å‘é€ä¿¡æ¯ã€‚
    Notify.test_email('QQ é‚®ç®±ç”¨æˆ·', 'æµ‹è¯•é‚®ä»¶ä¸»é¢˜', 'æµ‹è¯•é‚®ä»¶å†…å®¹').deliver_now
  ```
  - é…ç½®ç®¡ç†å‘˜(`root`)é»˜è®¤é‚®ç®±è´¦æˆ·ï¼Œæ“ä½œå¦‚ä¸‹ï¼š
    - ç™»å½•`GitLab`é¡µé¢ï¼Œå¹¶ç‚¹å‡»`Admin`ï¼Œé€‰æ‹©èœå•å¯¼èˆª`Users`è·³è½¬æ–°é¡µé¢ã€‚
    - åœ¨é¡µé¢ä¸­æ‰¾åˆ°`root`è´¦æˆ·å¹¶è¿›å…¥è´¦æˆ·è¯¦æƒ…é¡µï¼›ç‚¹å‡»`Edit`ï¼Œæ‰¾åˆ°`Email`é€‰é¡¹ï¼Œè¾“å…¥`QQ é‚®ç®±è´¦æˆ·`ï¼Œå¹¶ä¿å­˜ä¿®æ”¹ã€‚

## GitLab-Runner åº”ç”¨éƒ¨ç½²
### å¿«é€Ÿç†è§£ GitLab-Runner
- è¿è¡Œç”±`GitLab CI/CD`ç®¡ç†çš„ä½œä¸šçš„æœºå™¨ï¼Œå¯ç†è§£ä¸ºæµæ°´çº¿ã€‚
- ç®€ä¾¿äººä¸ºéƒ¨ç½²é¡¹ç›®ç«™ç‚¹è¿‡ç¨‹ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚

### éƒ¨ç½²æµç¨‹
1. å®‰è£…`GitLab-Runner`è½¯ä»¶åŒ…ï¼Œå¹¶æ‰§è¡Œè„šæœ¬ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
```bash
## ä¸‹è½½`RPM`æ ¼å¼ç±»å‹çš„ GitLab-Runner è½¯ä»¶åŒ…ï¼Œå¹¶æ‰§è¡Œè„šæœ¬ã€‚
curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh | sudo bash

## æŸ¥çœ‹ GitLab-Runner å¯ç”¨ç‰ˆæœ¬
yum list gitlab-runner --showduplicates | sort -r

## å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ GitLab-Runner è½¯ä»¶åŒ….
### ç‰¹åˆ«æ³¨æ„ï¼šGitLab-Runner ç‰ˆæœ¬å·å¿…é¡»ä¸ GitLab ç‰ˆæœ¬å·ä¸€è‡´ã€‚å¯é€šè¿‡æŒ‡å®š version è¿›è¡Œå®‰è£…ã€‚
sudo yum install -y gitlab-runner-<version>

## æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ
gitlab-runner --version
```

## é¡¹ç›® GitLab CI/CD æµæ°´çº¿éƒ¨ç½²æµç¨‹
1. è·å–é¡¹ç›®`GitLab Runner`æ‰€éœ€è¦çš„ä»¤ç‰Œã€‚
  - ç™»å½•`GitLab`é¡µé¢ï¼Œè¿›å…¥éƒ¨ç½²é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»`settings`,é€‰æ‹©`CI/CD`ï¼Œæ‰¾åˆ°`Runners`ä½ç½®ï¼Œç‚¹å‡»`Expand`ï¼Œç‚¹å‡»`Set up a specific Runner manually`ï¼Œå¤åˆ¶`URL`ä¸`Token`å€¼ã€‚
2. æ³¨å†Œé¡¹ç›®`GitLab CI/CD`æµæ°´çº¿æœåŠ¡ã€‚ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼š
```bash
## æ³¨å†Œé¡¹ç›® GitLab CI/CD æµæ°´çº¿æœåŠ¡
sudo gitlab-runner register

### äº¤äº’æç¤ºï¼šè¾“å…¥ GitLab CI/CD æµæ°´çº¿æœåŠ¡ URLï¼Œå³ å³éƒ¨ç½²é¡¹ç›® URL(åŸŸå æˆ– IP:Port)ï¼Œå‚è§ä¸Šä¸€æ­¥éª¤ Tokenã€‚
Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):
<URL>

### äº¤äº’æç¤ºï¼šè¾“å…¥ GitLab CI/CD æµæ°´çº¿æœåŠ¡ Tokenï¼Œå³éƒ¨ç½²é¡¹ç›® Tokenï¼Œå‚è§ä¸Šä¸€æ­¥éª¤ Tokenã€‚
Please enter the gitlab-ci token for this runner:
<Token>

### äº¤äº’æç¤ºï¼šè¾“å…¥ GitLab CI/CD æµæ°´çº¿æœåŠ¡æè¿°ï¼Œå³ Runner åç§°ï¼Œå‘½åæ ¼å¼ä¸ºï¼š<é¡¹ç›®å>-runnerã€‚
Please enter the description for this runner:
<project-name>-runner

### äº¤äº’æç¤ºï¼šè¾“å…¥ GitLab CI/CD æµæ°´çº¿æœåŠ¡æ ‡ç­¾ï¼Œ
Please enter the tags for this runner (comma separated):



### äº¤äº’æç¤ºï¼šè¾“å…¥ GitLab CI/CD æµæ°´çº¿æœåŠ¡æ‰§è¡Œå™¨ï¼Œå³ Runner æ‰§è¡Œå™¨ç±»å‹ï¼Œé»˜è®¤ä¸º shellã€‚
Please enter the executor: ssh, virtualbox, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, docker-ssh, shell:
shell

### äº¤äº’æç¤ºï¼šè¾“å…¥ GitLab CI/CD æµæ°´çº¿æœåŠ¡æ‰§è¡Œå™¨ç±»å‹ï¼Œå³ Runner æ‰§è¡Œå™¨ç±»å‹ï¼Œé»˜è®¤ä¸º shellã€‚
### ç‰¹åˆ«æ³¨æ„ï¼šè‹¥é€‰æ‹© ssh æ‰§è¡Œå™¨ç±»å‹ï¼Œåˆ™å¿…é¡»è¾“å…¥ ssh-key å€¼ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œæµæ°´çº¿ã€‚
Please enter the default shell for the runner:
/bin/bash
```

3. é…ç½®é¡¹ç›®`GitLab CI/CD`æµæ°´çº¿ã€‚åœ¨æ‰€éƒ¨ç½²é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º`gitlab-ci.yml`æ–‡ä»¶ï¼Œå¹¶å†™å…¥é…ç½®å†…å®¹ã€‚
**ç‰¹åˆ«æé†’**ï¼šè‹¥å­˜åœ¨å¯¹æ ‡å¤§å‚å¼€å‘è§„èŒƒï¼Œå³é¡¹ç›®é…ç½® `eslint`ã€`prettir`ã€`git commit`ç­‰æäº¤è§„èŒƒï¼Œå³å¯å¿½ç•¥`stages`é‡Œçš„é˜¶æ®µ`eslint`ã€`format`ç­‰ç±»ä¼¼æ­¥éª¤ã€‚

```yaml
image: node:latest

## æ¨èæ ‡å‡†åŒ–è¿™äº”ä¸ªé˜¶æ®µæ¨¡å¼
stages:
  ## è¯­æ³•æ£€æŸ¥ä¸ä»£ç æ ¼å¼
  - eslint
  ## é¡¹ç›®æ„å»ºæ‰“åŒ…
  - build
  ## éƒ¨ç½²å¼€å‘ç¯å¢ƒé¡¹ç›®
  - deploy
  ## æµ‹è¯•å¼€å‘ç¯å¢ƒé¡¹ç›®åŠŸèƒ½
  - test
  ## éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒé¡¹ç›®
  - release

cache:
  paths:
    - node_modules/

## å°†æ‰“åŒ…ç»“æœç¼“å­˜ï¼Œé¿å…æ¯æ¬¡æ‰“åŒ…éƒ½é‡æ–°ä¸‹è½½ä¾èµ–åŒ…
artifacts:
  paths:
    - dist/

## è„šæœ¬æ‰§è¡Œå‰å®‰è£…ç›¸å…³ä¾èµ–
before_script:
  - npm install

## è¯­æ³•æ£€æŸ¥ã€ä»£ç æ ¼å¼åŒ–é˜¶æ®µ
eslint_job:
  stage: eslint
  script:
    - npm run lint

## é¡¹ç›®æ‰“åŒ…é˜¶æ®µ
build_job:
  stage: build
  script:
    - npm run build

## é¡¹ç›®å¼€å‘é˜¶æ®µ
deploy_job:
  stage: deploy
  ## å…¶å®ƒåˆ†æ”¯æäº¤æ‰ä¼šæ‰§è¡Œ
  only:
    - branches
  environment:
    name: <é¡¹ç›®åº”ç”¨åç§°>
    url: <é¡¹ç›®è®¿é—®åœ°å€>
  script:
    - npm run deploy

## é¡¹ç›®æµ‹è¯•é˜¶æ®µ
test_job:
  stage: test
  script:
    - echo "é¡¹ç›®æµ‹è¯•é˜¶æ®µ"

## é¡¹ç›®å‘å¸ƒé˜¶æ®µ
release_job:
  stage: release
  ## ä¸»åˆ†æ”¯æ‰ä¼šæ‰§è¡Œ
  only:
    - main
  ## é¡¹ç›®ç¯å¢ƒå˜é‡
  environment:
    name: <é¡¹ç›®åº”ç”¨åç§°>
    url: <é¡¹ç›®è®¿é—®åœ°å€>
  script:
    - npm run release
```

